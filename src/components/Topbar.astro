---
import { useTranslations } from '../i18n/ui';
import LangSwitcher from './LangSwitcher.astro';
const t = useTranslations(Astro);
---
<header class="sticky top-0 bg-[#fff] backdrop-saturate-150 backdrop-blur z-20">
  <div
    class="mx-auto w-full max-w-[1170px] px-5 flex items-center justify-between py-4"
  >
    <div class="font-logo text-main-rose" aria-label="Vlada Polianskaya">
      Vlada<br />Polyanskaya
    </div>

    <!-- Toggle (CSS-only via peer) -->
    <label
      for="nav-toggle"
      class="lg:hidden cursor-pointer p-2 -m-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3e5348] focus:ring-offset-2"
      aria-label="Menu"
      aria-controls="site-nav"
    >
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        class="w-7 h-7 text-[#333]"
        ><path d="M3 6h18M3 12h18M3 18h18"></path></svg
      >
    </label>
    <input id="nav-toggle" type="checkbox" class="peer hidden" />

    <nav
      id="site-nav"
      aria-label="Main navigation"
      class="absolute left-0 right-0 top-full bg-[#fff] border-t border-b border-[#e6e6e6] shadow-[0_10px_30px_rgba(0,0,0,0.06)] opacity-0 -translate-y-2 pointer-events-none transition-opacity transition-transform duration-200 ease-out peer-checked:opacity-100 peer-checked:translate-y-0 peer-checked:pointer-events-auto lg:static lg:opacity-100 lg:translate-y-0 lg:pointer-events-auto lg:shadow-none lg:border-none lg:bg-transparent lg:transition-none lg:duration-0 motion-reduce:transition-none"
    >
      <ul class="flex flex-col lg:flex-row lg:gap-7 m-0 p-0 list-none items-center">
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0">
          <a
            href="#about"
            class="nav-link block px-5 py-4 lg:px-0 lg:py-2 font-medium text-[14px] tracking-[0.04em] active:bg-[#f2f0e6] lg:active:bg-transparent"
            >{t('nav.about')}</a
          >
        </li>
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0">
          <a
            href="#portfolio"
            class="nav-link block px-5 py-4 lg:px-0 lg:py-2 font-medium text-[14px] tracking-[0.04em] active:bg-[#f2f0e6] lg:active:bg-transparent"
            >{t('nav.portfolio')}</a
          >
        </li>
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0">
          <a
            href="#services"
            class="nav-link block px-5 py-4 lg:px-0 lg:py-2 font-medium text-[14px] tracking-[0.04em] active:bg-[#f2f0e6] lg:active:bg-transparent"
            >{t('nav.services')}</a
          >
        </li>
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0">
          <a
            href="#contacts"
            class="nav-link block px-5 py-4 lg:px-0 lg:py-2 font-medium text-[14px] tracking-[0.04em] active:bg-[#f2f0e6] lg:active:bg-transparent"
            >{t('nav.contacts')}</a
          >
        </li>
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0">
          <a
            href="#"
            id="nav-booking-terms"
            class="nav-link block px-5 py-4 lg:px-0 lg:py-2 font-medium text-[14px] tracking-[0.04em] active:bg-[#f2f0e6] lg:active:bg-transparent"
            >{t('nav.booking')}</a
          >
        </li>
        <li class="border-t first:border-t-0 border-[#e6e6e6] lg:border-0 lg:ml-4">
          <LangSwitcher />
        </li>
      </ul>
    </nav>
  </div>
</header>

<!-- Booking Terms Modal -->
<div id="topbar-modal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
  <div id="topbar-modal-backdrop" class="absolute inset-0 bg-black/50"></div>
  <div
    class="relative mx-auto my-8 max-w-[900px] px-5"
    role="dialog"
    aria-modal="true"
    aria-labelledby="topbar-modal-title"
  >
    <div class="bg-white rounded-md shadow-xl overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-[#eee]">
        <h3 id="topbar-modal-title" class="text-xl font-semibold m-0"></h3>
        <button
          id="topbar-modal-close"
          type="button"
          class="inline-flex items-center justify-center text-[#666] hover:text-[#111] transition-colors"
          aria-label="Close"
        >
          ✕
        </button>
      </div>
      <div id="topbar-modal-content" class="px-5 py-5 leading-relaxed text-[#444] overflow-y-auto max-h-[75vh]"></div>
    </div>
  </div>
</div>

<script is:inline>
  function initTopbar() {
    const btn = document.getElementById("nav-booking-terms");
    const toggle = document.getElementById("nav-toggle");
    // Modal refs
    const modal = document.getElementById("topbar-modal");
    const modalContent = document.getElementById("topbar-modal-content");
    const modalClose = document.getElementById("topbar-modal-close");
    const modalBackdrop = document.getElementById("topbar-modal-backdrop");

    const bookingTermsHTML = `
    <ul>
      <li>Я не предоставляю исходные файлы (<strong>RAW</strong>), так как это незаконченный материал.</li>
      <li>Я не выполняю глубокую ретушь и не изменяю внешность — удаляю только временные недостатки (прыщи, синяки, царапины).</li>
      <li>Я оставляю за собой право выбора фотографий, которые будут обработаны и переданы. Повторная обработка или изменения по запросу не выполняются.</li>
      <li>В случае опоздания на съёмку потерянное время вычитается из оплаченной сессии.</li>
      <li>Обработанные фотографии хранятся ограниченное время после передачи. Ответственность за загрузку и сохранность файлов после этого периода лежит на клиенте.</li>
      <li>Бронируя дату, вы даёте согласие на использование ваших фотографий в моём портфолио, в социальных сетях и для продвижения моей деятельности.</li>
    </ul>

    <p><em>Если вы не хотите, чтобы ваши фотографии публиковались, пожалуйста, сообщите об этом до бронирования.</em></p>

    <ul>
      <li>Бронируя дату, вы соглашаетесь с моим стилем съёмки и подходом к обработке / ретуши, а также с условиями, изложенными здесь. 
      Пожалуйста, ознакомьтесь с моим портфолио и этими правилами до бронирования.</li>
    </ul>

    <h3>Мудборд и подготовка к съёмке</h3>
    <p>Для каждой съёмки я составляю <strong>мудборд</strong> — визуальную концепцию нашей фотосессии. 
    Мы обсуждаем ваши пожелания, и на их основе я подбираю подходящие референсы. 
    Если вы затрудняетесь с пожеланиями, вы можете указать на примеры из моего портфолио, и я буду отталкиваться от этого.</p>

    <p>Помимо концепции съёмки, я даю рекомендации по образам и прикрепляю <em>референсы по позированию</em>, 
    чтобы мы могли обращаться к ним во время съёмки. 
    Я всегда направляю и подсказываю во время процесса, а референсы носят лишь рекомендательный характер.</p>`;

    function openModal() {
      if (!modal || !modalContent) return;
      const titleEl = document.getElementById("topbar-modal-title");
      if (titleEl) titleEl.textContent = document.documentElement.lang === 'ru' ? 'Условия предоставления услуг' : (document.documentElement.lang === 'de' ? 'Buchungsbedingungen' : 'Booking Terms');
      modalContent.innerHTML = `<div class=\"text-[#555] leading-relaxed space-y-3\">${bookingTermsHTML}</div>`;
      modal.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }
    function closeModal() {
      if (!modal) return;
      modal.classList.add("hidden");
      document.body.style.overflow = "";
    }

    modalClose?.addEventListener("click", closeModal, { passive: true });
    modalBackdrop?.addEventListener("click", closeModal, { passive: true });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modal?.classList.contains("hidden")) closeModal();
    });

    if (btn) {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        // close mobile menu if open
        if (toggle && toggle.checked) toggle.checked = false;
        openModal();
      });
    }
  }
  document.addEventListener("astro:page-load", initTopbar);
  document.addEventListener("astro:after-swap", initTopbar);
  document.addEventListener("DOMContentLoaded", initTopbar);
</script>

<style>
  /* Minimal, elegant fade effect */
  .nav-link {
    color: #3a3a3a;
    opacity: 0.75;
    transition:
      color 180ms ease,
      opacity 180ms ease;
  }
  .nav-link:hover,
  .nav-link:focus-visible {
    color: #111;
    opacity: 1;
    outline: none;
  }
  @media (prefers-reduced-motion: reduce) {
    .nav-link {
      transition: none;
    }
  }
</style>
